<?phpclass OtaAccountModel extends Base_Model_Abstract{	protected $dbname = 'itourism';    protected $tblname = 'ota_account';    protected $pkKey = 'id';    protected $preCacheKey = 'cache|OtaAccountModel|';    public $config = array( //OTA设置，以orders表的source字段为键        1 => array(  //淘宝            'source'=>1,            'otaName'=>'淘宝',            'addAndPay'=>0, //下单和支付是否原子操作，1是（原子操作），0否（事务分开）            'sendPayErrMessage'=>1, //支付错误时是否站内信通知分销商，1是，0否            'payErrMessage'=>'您有一条淘宝订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。',            'sendPayErrSmsMsg'=>1, //支付错误时是否短信通知分销商，1是，0否            'payErrSmsMsg'=>'您有一条淘宝订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。',            'autoCancelOrderExpire'=>7200, //自动取消订单过期时间，0系统默认，大于0 过期秒数            'autoRefund'=>0, //自动申请退票，1允许，0禁止        ),        10=> array( //去哪儿            'source'=>10,            'otaName'=>'去哪儿',            'addAndPay'=>0, //下单和支付是否原子操作，1是（原子操作），0否（事务分开）            'sendPayErrMessage'=>1, //支付错误时是否站内信通知分销商，1是，0否            'payErrMessage'=>'您有一条去哪儿订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。',            'sendPayErrSmsMsg'=>1, //支付错误时是否短信通知分销商，1是，0否            'payErrSmsMsg'=>'您有一条去哪儿订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。',            'autoCancelOrderExpire'=>7200, //自动取消订单过期时间，0系统默认，大于0 过期秒数            'autoRefund'=>0, //自动申请退票，1允许，0禁止        ),    );        public function getTable()    {        return $this->tblname;    }    public function getPayErrMessage($source,$data){ //获取支付错误时的站内信通知内容        if(!$source || !$data) return false;        $content = !empty($this->config[$source]['sendPayErrMessage'])?trim($this->config[$source]['payErrMessage']):'';        !$content && $content='您有一条{otaName}订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。';        $data['otaName']=$this->config[$source]['otaName'];        foreach($data as $k=>$v){            $content = str_replace('{'.$k.'}',$v,$content);        }        return $content;    }    public function getPayErrSmsMsg($source,$data){ //获取支付错误时的短信通知内容        if(!$source || !$data) return false;        $content = !empty($this->config[$source]['sendPayErrSmsMsg'])?trim($this->config[$source]['payErrSmsMsg']):'';        !$content && $content='您有一条{otaName}订单号为{orderId}的订单因{errMsg}({paymentName})原因未支付成功，请在两小时内完成支付，否则订单将自动取消。';        $data['otaName']=$this->config[$source]['otaName'];        foreach($data as $k=>$v){            $content = str_replace('{'.$k.'}',$v,$content);        }        return $content;    }}